<!DOCTYPE html>
<html>
<head>
    <title>Trailrunningmap.ch</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <style>
        body {
            padding: 0;
            margin: 0;
        }
        html, body, #map {
            height: 100%;
            width: 100%;
        }
        .mobile-controls {
            display: none;
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.9);
            padding: 10px 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            width: 80%;
            max-width: 300px;
        }
        .slider-container {
            display: flex;
            align-items: center;
            margin: 8px 0;
            gap: 10px;
        }
        .slider-icon {
            width: 20px;
            color: #666;
            text-align: center;
        }
        .slider {
            flex-grow: 1;
        }
        @media (max-width: 768px) {
            .mobile-controls {
                display: block;
            }
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <div class="mobile-controls">
        <div class="slider-container">
            <div class="slider-icon">
                <i class="fas fa-mountain"></i>
            </div>
            <input type="range" id="relief-slider" class="slider" min="0" max="100" value="50">
        </div>
        <div class="slider-container">
            <div class="slider-icon">
                <i class="fas fa-hiking"></i>
            </div>
            <input type="range" id="hiking-slider" class="slider" min="0" max="100" value="50">
        </div>
    </div>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js"></script>
    <script src="https://unpkg.com/@maplibre/maplibre-gl-leaflet@0.0.19/leaflet-maplibre-gl.js"></script>
    <script>
        var map = L.map('map').setView([46.86, 8.30], 9);

        // SwissALTI3D WMTS layer (base layer)
        var baseLayer = L.tileLayer('https://wmts.geo.admin.ch/1.0.0/ch.swisstopo.swissalti3d-reliefschattierung/default/current/3857/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.swisstopo.admin.ch/">swisstopo</a>',
            maxZoom: 18,
            minZoom: 6
        });

        // Vector basemap layer
        var basemapLayer = L.maplibreGL({
            style: 'https://vectortiles.geo.admin.ch/styles/ch.swisstopo.basemap.vt/style.json',
            attribution: '&copy; <a href="https://www.swisstopo.admin.ch/">swisstopo</a>'
        });

        // Hiking trails layer
        var hikingLayer = L.tileLayer('https://wmts.geo.admin.ch/1.0.0/ch.swisstopo.swisstlm3d-wanderwege/default/current/3857/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.swisstopo.admin.ch/">swisstopo</a>',
            maxZoom: 18,
            minZoom: 6
        });

        // Add layers
        basemapLayer.addTo(map);
        baseLayer.addTo(map);
        hikingLayer.addTo(map);

        // Helper function to apply buffer and clamp values
        function getBufferedOpacity(value, min = 0, max = 1, bufferPercent = 5) {
            const bufferZone = bufferPercent / 100;
            
            if (value <= bufferZone) {
                return min;
            } else if (value >= (1 - bufferZone)) {
                return max;
            }
            
            // Rescale the middle 90% to full range
            return (value - bufferZone) * (max - min) / (1 - 2 * bufferZone);
        }

        // Function to handle both mouse and touch events
        function handleInteraction(clientX, clientY) {
            // Only handle mouse/touch interactions on desktop
            if (window.innerWidth > 768) {
                var width = map.getContainer().offsetWidth;
                var height = map.getContainer().offsetHeight;
                
                // X-axis controls relief layer opacity (with buffer)
                var normalizedX = clientX / width;
                var reliefOpacity = getBufferedOpacity(normalizedX);
                baseLayer.setOpacity(reliefOpacity);

                // Y-axis controls hiking trails opacity (inverted, with buffer)
                var normalizedY = clientY / height;
                var hikingOpacity = getBufferedOpacity(1 - normalizedY);
                hikingLayer.setOpacity(hikingOpacity);
            }
        }

        // Mouse move handler
        map.getContainer().addEventListener('mousemove', function(e) {
            handleInteraction(e.clientX, e.clientY);
        });

        // Handle slider changes
        document.getElementById('relief-slider').addEventListener('input', function(e) {
            const opacity = e.target.value / 100;
            baseLayer.setOpacity(opacity);
        });

        document.getElementById('hiking-slider').addEventListener('input', function(e) {
            const opacity = e.target.value / 100;
            hikingLayer.setOpacity(opacity);
        });

        // Reset opacities when mouse leaves the map (desktop only)
        function resetOpacities() {
            if (window.innerWidth > 768) {
                baseLayer.setOpacity(0.5);
                hikingLayer.setOpacity(0.5);
            }
        }

        map.getContainer().addEventListener('mouseleave', resetOpacities);
    </script>
</body>
</html>
